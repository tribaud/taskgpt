<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <title>Task Manager + IA</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <header>
        <h1>√âditeur de t√¢ches (tasks.json) + Chat IA</h1>
        <button id="themeToggle" class="theme-toggle">üåô</button>
    </header>
    <div class="wrap">

        <div class="toolbar">
            <div class="group">
                <button class="primary" id="btnNew">üÜï Nouveau</button>
                <button id="btnOpen">üìÇ Ouvrir</button>
                <button id="btnSave">üíæ Sauvegarder JSON</button>
                <button id="btnExportMD">üìÑ Exporter Markdown</button>
                <button id="btnCopyPrompt">üìã Copier prompt initial</button>
                <button id="btnSettings">‚öôÔ∏è Param√®tres</button>
            </div>
            <div class="group">
                <label class="muted">Mod√®le JSON normalis√©</label>
                <select id="schemaSelect">
                    <option value="v1" selected>v1 (id,title,description,priority,done,dependencies,tags)</option>
                </select>
            </div>
        </div>

        <div class="grid">
            <!-- TABLEAU T√ÇCHES -->
            <section class="card">
                <h2>T√¢ches</h2>
                <div class="row-actions" style="margin-bottom:8px;">
                    <button id="btnAdd">‚ûï Ajouter une t√¢che</button>
                    <button id="btnSort">‚ÜïÔ∏è R√©ordonner (T‚Ä¶ croissant)</button>
                </div>
                <div style="overflow:auto; max-height: 60vh;">
                    <table>
                        <thead>
                            <tr>
                                <th style="width:60px;">Done</th>
                                <th style="width:110px;">ID</th>
                                <th>Title</th>
                                <th>Description</th>
                                <th style="width:120px;">Priority</th>
                                <th>Dependencies</th>
                                <th>Tags</th>
                                <th style="width:120px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tbody"></tbody>
                    </table>
                </div>
            </section>

            <!-- PANNEAU LAT√âRAL: R√âCENTS + CHAT -->
            <aside class="card">
                <h2>Chat IA</h2>
                <div class="group" style="margin-bottom:8px;">
                    <input type="password" id="apiKey" placeholder="OpenAI API Key" style="min-width:220px;" />
                    <select id="model">
                        <option value="gpt-4o-mini" selected>gpt-4o-mini</option>
                        <option value="gpt-4o">gpt-4o</option>
                    </select>
                </div>
                <div class="group" style="display:block; width:100%;">
                    <label for="systemPrompt" class="muted">Prompt syst√®me (impose JSON valide)</label>
                    <textarea id="systemPrompt" rows="5" style="width:100%;">Tu es un assistant qui g√®re un fichier tasks.json.
R√©ponds UNIQUEMENT par du JSON strict valide.
Sch√©ma attendu (v1): {"tasks":[{"id":"T001","title":"...","description":"...","priority":"high|medium|low","done":false,"dependencies":[],"tags":[]}]}.
- N'ajoute pas de texte hors JSON.
- Si le JSON actuel est fourni, retourne une version mise √† jour en respectant le sch√©ma.
- Conserve les IDs existants, ajoute-en de nouveaux si n√©cessaire (format T###).</textarea>
                </div>
                <div id="chatBox" class="card" style="margin:8px 0 8px; padding:10px;"></div>
                <textarea id="userMsg" rows="4" placeholder="Ex: D√©compose T002 en 3 sous-t√¢ches d√©pendantes‚Ä¶"
                    style="width:100%;"></textarea>
                <div class="row-actions" style="margin-top:8px;">
                    <button id="btnSend">Envoyer √† l‚ÄôIA</button>
                    <button id="btnInject">‚úÖ Inclure JSON actuel</button>
                </div>
                <p class="muted">‚ö†Ô∏è L'appel direct au navigateur expose votre cl√© API au code client. Pour une prod
                    s√©curis√©e, passez par un proxy serveur ou OpenRouter avec cl√©s c√¥t√© serveur.</p>
            </aside>
        </div>

        <!-- SETTINGS MODAL -->
        <div id="settingsModal" class="modal" style="display: none;">
            <div class="modal-content card">
                <div class="modal-header">
                    <h2>Param√®tres</h2>
                    <button id="closeSettings" class="close-button">‚úï</button>
                </div>
                <div class="modal-body">
                    <div class="settings-section">
                        <h3>Connecteurs LLM</h3>
                        <div class="form-group">
                            <label for="llmProvider">Fournisseur LLM</label>
                            <select id="llmProvider">
                                <option value="openai">OpenAI</option>
                                <option value="openrouter">OpenRouter</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="openaiApiKey">Cl√© API OpenAI</label>
                            <input type="password" id="openaiApiKey" placeholder="Entrez votre cl√© API OpenAI" />
                        </div>

                        <div class="form-group">
                            <label for="openrouterApiKey">Cl√© API OpenRouter</label>
                            <input type="password" id="openrouterApiKey" placeholder="Entrez votre cl√© API OpenRouter" />
                        </div>

                        <div class="form-group">
                            <label for="openrouterModel">Mod√®le OpenRouter</label>
                            <div style="display: flex; gap: 8px;">
                                <select id="openrouterModelSelect" style="flex: 1;">
                                    <option value="openai/gpt-4o-mini">GPT-4o Mini</option>
                                    <option value="openai/gpt-4o">GPT-4o</option>
                                    <option value="anthropic/claude-3.5-sonnet">Claude 3.5 Sonnet</option>
                                    <option value="google/gemini-pro">Gemini Pro</option>
                                    <option value="meta-llama/llama-3.1-70b-instruct">Llama 3.1 70B</option>
                                    <option value="mistralai/mistral-nemo">Mistral Nemo</option>
                                    <option value="qwen/qwen-2.5-72b-instruct">Qwen 2.5 72B</option>
                                </select>
                                <input type="text" id="openrouterModelCustom" placeholder="Ou entrez un mod√®le personnalis√©" style="flex: 1;"/>
                            </div>
                            <input type="hidden" id="openrouterModel" value="openai/gpt-4o-mini"/>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Apparence</h3>
                        <div class="form-group">
                            <label for="themeSelect">Th√®me</label>
                            <select id="themeSelect">
                                <option value="dark">Sombre</option>
                                <option value="light">Clair</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="saveSettings" class="primary">Enregistrer</button>
                    <button id="cancelSettings">Annuler</button>
                </div>
            </div>
        </div>
    </div>

    <script src="dist/renderer.js"></script>
</body>

</html>
